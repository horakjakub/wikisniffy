"use strict";var ModuleManager=function(){function e(e,t,n){for(var r=0;r<t.length;r++)t[r]=i[t[r]];i[e]=n.apply(n,t)}function t(e){return i[e]}var i={};return{define:e,get:t}}();ModuleManager.define("$document",[],function(){return document}),ModuleManager.define("$window",[],function(){return window}),ModuleManager.define("$q",["$window"],function(e){return e.Q}),ModuleManager.define("$MediaWikiJS",["$window"],function(e){return e.MediaWikiJS}),ModuleManager.define("DOMService",["$document"],function(e){var t={};return t.createDomEl=function(t,i,n,r){var a=e.createElement(t);if(a.className=i,void 0!==n&&null!==n){var o=e.createTextNode(n);a.appendChild(o)}return"object"==typeof r&&"length"in r&&r.forEach(function(e){a.setAttribute(e[0],e[1])}),a},t.addTextNode=function(t,i){var n=e.createTextNode(i);return void 0!==t&&null!==t&&t.appendChild(n),n},t.appendChildren=function(e,t){t.forEach(function(t){e.appendChild(t)})},t.addAttributes=function(e,t){t.forEach(function(t){e.setAttribute(t[0],t[1])})},t}),ModuleManager.define("WikiReqeuestsService",["$q","$MediaWikiJS"],function(e,t){var i={};return i.sendAutocompleteRequestPromise=function(i){var n=e.defer();return t("https://en.wikipedia.org",{action:"query",list:"search",srsearch:i,srprop:"title",srlimit:10},function(e){n.resolve(e)}),n.promise},i.sendSearchRequestPromise=function(i){var n=e.defer();return t("https://en.wikipedia.org",{action:"query",list:"allpages",apfrom:i,aplimit:10,apfilterredir:"nonredirects"},function(e){n.resolve(e)}),n.promise},i.sendResultsDetailPromise=function(i){var n=e.defer();return t("https://en.wikipedia.org",{action:"query",titles:i,prop:"info|images",inprop:"url",imimages:""},function(e){n.resolve(e)}),n.promise},i.sendExtractPromise=function(i){var n=e.defer();return t("https://en.wikipedia.org",{action:"query",titles:i,prop:"extracts",exintro:"",explaintext:""},function(e){n.resolve(e)}),n.promise},i.sendImageURLPromise=function(i){var n=e.defer();return t("https://en.wikipedia.org",{action:"query",titles:i,prop:"imageinfo",iiprop:"url"},function(e){n.resolve(e)}),n.promise},i}),ModuleManager.define("autocompleteDirective",["$document","DOMService"],function(e,t){var i=t.createDomEl("div","jh-autocomplete__wrapper"),n=t.createDomEl("input","jh-autocomplete__input",null,[["type","search"]]),r=t.createDomEl("div","jh-autocomplete__list-container"),a=t.createDomEl("ul","jh-autocomplete__list"),o=t.createDomEl("li","jh-autocomplete__list-item");r.appendChild(a),i.appendChild(n),i.appendChild(r);var l={};return l.create=function(e,n){function r(t){if(1===t.key.length||"Backspace"===t.key){var i=t.key,r=null;"Backspace"===i?(r=l.value.slice(0,-1),r.length<3&&(l.className="jh-autocomplete__input")):r=l.value+i,a.value=r,r.length>2&&(l.className=l.className+" jh-autocomplete__input--autocomplete-visible",e(r))}else("ArrowDown"===t.key||"ArrowUp"===t.key)&&l.value.length>2||"Enter"===t.key&&0!==l.value.length&&n(l.value)}var a=i.cloneNode(!0),l=a.children[0],c=a.children[1].children[0],u=o.cloneNode(!0);return a.value="",l.addEventListener("keydown",r),a.createAutocompleteMenu=function(e){if(0!==c.children.length)for(var i=0,r=c.children.length;i<r;i++)c.removeChild(c.children[0]);e.forEach(function(e){var i=u.cloneNode(!0);t.addTextNode(i,e),i.addEventListener("click",function(e){var t=this.innerText;l.className="jh-autocomplete__input",l.value=t,n(t)}),c.appendChild(i)})},a},l}),ModuleManager.define("articleDirective",["$document","DOMService"],function(e,t){function i(e){var i=this.children[1].children[0];t.addTextNode(i,e)}function n(e){this.children[1].children[1].children[0].src=e}function r(e){this.children[0].children[0].setAttribute("href",e)}function a(e){var i=this.children[0].children[0];t.addTextNode(i,e)}var o=t.createDomEl("article",""),l=t.createDomEl("aside",""),c=t.createDomEl("header",""),u=t.createDomEl("content",""),s=t.createDomEl("section",""),d=t.createDomEl("a",""),h=t.createDomEl("img","");l.appendChild(h),t.appendChildren(u,[s,l]),c.appendChild(d),t.appendChildren(o,[c,u]);var f={};return f.create=function(){var e=o.cloneNode(!0);return e.setDescriptionText=i,e.setImageURL=n,e.setLinkURL=r,e.setArticleTitle=a,e},f}),ModuleManager.define("SearchingViewController",["$document","$window","WikiReqeuestsService","DOMService","articleDirective","autocompleteDirective"],function(e,t,i,n,r,a){function o(){f(_.value)}function l(e){var t=r.create();t.setLinkURL(e.url),t.setArticleTitle(e.title),D.appendChild(t)}function c(e,t){t=t||"./img/wiki.png",D.children[e].setImageURL(t)}function u(e,t){D.children[e].setDescriptionText(t)}function s(){if(0!==D.children.length)for(var e=0,t=D.children.length;e<t;e++)D.removeChild(D.children[0])}function d(){M&&(g.className="",M=!1)}function h(e){k.sendAutocompleteRequestPromise(e).then(function(e){x.autocompleteOptions=v(e.query.search,"title")})}function f(e){s(),k.sendSearchRequestPromise(e).then(function(e){var t=e.query.allpages;k.sendResultsDetailPromise(v(t,"title").join("|")).then(function(e){var t=e.query.pages,i=[],n=0;for(var r in t)i.push({title:t[r].title,url:t[r].fullurl}),t[r].images&&0!==t[r].images.length&&(i[n].imageTitle=t[r].images[0].title),n+=1;x.searchDetails=i})})}function p(e,t){e.imageTitle?k.sendImageURLPromise(e.imageTitle).then(function(e){var i=e.query.pages;for(var n in i)i[n].imageinfo&&0!==i[n].imageinfo.length?x.imageURLdata={index:t,url:i[n].imageinfo[0].url||null}:x.imageURLdata={index:t,url:null}}):x.imageURLdata={index:t,url:null}}function m(e,t){e.title&&k.sendExtractPromise(e.title).then(function(e){var i=e.query.pages;for(var n in i)x.descriptionData={index:t,text:i[n].extract}})}function v(e,t){for(var i=[],n=0,r=e.length;n<r;n++)i.push(e[n][t]);return i}var g=n.createDomEl("nav","nav--starting-site-state",null,[["id","navigationContainer"]]),D=n.createDomEl("main","main-container",null,[["id","mainResultsContainer"]]),E=n.createDomEl("button","","Sniff!",[["id","searchButton"]]),R=n.createDomEl("h3","","WikiSniffy"),_=a.create(h,f);e.body.insertBefore(D,e.body.children[0]),e.body.insertBefore(g,e.body.children[0]),n.appendChildren(g,[R,_,E]),E.addEventListener("click",o);var M=!0,x={_searchDetails:null,_autocompleteOptions:null,_lastRecivedImageURLdata:null,_lastRecivedDescriptionData:null,_articlesImageURLCollection:{},_articlesTextDataCollection:{},set autocompleteOptions(e){this._autocompleteOptions=e,_.createAutocompleteMenu(e)},set searchDetails(e){this._searchResults=e,e.forEach(l),e.forEach(m),d()},set imageURLdata(e){this._lastRecivedImageURLdata=e,this._articlesImageURLCollection[e.index]=e.url,c(e.index,e.url)},set descriptionData(e){this._lastRecivedDescriptionData=e,this._articlesImageURLCollection[e.index]=e.text,u(e.index,e.text);var t=0;for(var e in this._articlesImageURLCollection)++t===this._searchResults.length&&this._searchResults.forEach(p)}},k=i});